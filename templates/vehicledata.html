<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Vehicle Insurance Prediction</title>
    <link rel="stylesheet" href="/static/css/style.css" />
  </head>
  <body>
    <div class="container">
      <h1>Vehicle Insurance Prediction</h1>

      <form method="post" action="/" class="card" id="predict-form">
        <div class="grid">
          <div class="field">
            <label for="Gender">Gender</label>
            <select id="Gender" name="Gender" required>
              <option value="" disabled selected>Select</option>
              <option value="1">Male</option>
              <option value="0">Female</option>
            </select>
          </div>

          <div class="field">
            <label for="Age">Age</label>
            <input type="number" id="Age" name="Age" min="0" required />
          </div>

          <div class="field">
            <label for="Driving_License">Driving License</label>
            <select id="Driving_License" name="Driving_License" required>
              <option value="" disabled selected>Select</option>
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </div>

          <div class="field">
            <label for="Region_Code">Region Code</label>
            <input
              type="number"
              step="0.01"
              id="Region_Code"
              name="Region_Code"
              required
            />
          </div>

          <div class="field">
            <label for="Previously_Insured">Previously Insured</label>
            <select id="Previously_Insured" name="Previously_Insured" required>
              <option value="" disabled selected>Select</option>
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </div>

          <div class="field">
            <label for="Annual_Premium">Annual Premium</label>
            <input
              type="number"
              step="0.01"
              id="Annual_Premium"
              name="Annual_Premium"
              required
            />
          </div>

          <div class="field">
            <label for="Policy_Sales_Channel">Policy Sales Channel</label>
            <input
              type="number"
              step="0.01"
              id="Policy_Sales_Channel"
              name="Policy_Sales_Channel"
              required
            />
          </div>

          <div class="field">
            <label for="Vintage">Vintage</label>
            <input type="number" id="Vintage" name="Vintage" required />
          </div>

          <div class="field">
            <label for="Vehicle_Age_lt_1_Year">Vehicle Age < 1 Year</label>
            <select
              id="Vehicle_Age_lt_1_Year"
              name="Vehicle_Age_lt_1_Year"
              required
            >
              <option value="" disabled selected>Select</option>
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </div>

          <div class="field">
            <label for="Vehicle_Age_gt_2_Years">Vehicle Age > 2 Years</label>
            <select
              id="Vehicle_Age_gt_2_Years"
              name="Vehicle_Age_gt_2_Years"
              required
            >
              <option value="" disabled selected>Select</option>
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </div>

          <div class="field">
            <label for="Vehicle_Damage_Yes">Vehicle Damage</label>
            <select id="Vehicle_Damage_Yes" name="Vehicle_Damage_Yes" required>
              <option value="" disabled selected>Select</option>
              <option value="1">Yes</option>
              <option value="0">No</option>
            </select>
          </div>
        </div>
        <div class="actions">
          <button type="submit">Predict</button>
        </div>
      </form>

      {% if context %}
      <div id="result-modal" class="modal" data-open="true">
        <div class="modal-content" id="modal-card">
          <span class="modal-close" id="modal-close">×</span>
          <div class="modal-header">
            <div class="status-icon" id="status-icon">!</div>
            <div>
              <h2 id="modal-title">Prediction</h2>
              <p class="modal-subtitle" id="modal-subtitle">
                Eligibility result
              </p>
            </div>
          </div>
          <p class="prediction-text" id="prediction-text">{{ context }}</p>
          <div class="modal-actions">
            <button id="modal-ok" class="button">OK</button>
          </div>
        </div>
      </div>
      {% endif %}
    </div>

    <!-- Loading overlay -->
    <div id="loading-overlay" class="loading-overlay" style="display: none">
      <div class="loading-content">
        <div class="spinner" aria-hidden="true"></div>
        <div class="loading-text">Processing prediction…</div>
      </div>
    </div>

    <script>
      (function () {
        var modal = document.getElementById("result-modal");
        var modalCard = document.getElementById("modal-card");
        var predictionEl = document.getElementById("prediction-text");
        var statusIcon = document.getElementById("status-icon");
        var modalTitle = document.getElementById("modal-title");
        var modalSubtitle = document.getElementById("modal-subtitle");
        // Enhance modal content based on server context
        if (modal && predictionEl && modalCard) {
          var raw = predictionEl.textContent || "";
          var isYes = /yes/i.test(raw);
          var message = isYes
            ? "You are Eligible for insurance."
            : "You are not eligible for insurance.";
          predictionEl.textContent = message;
          modalCard.classList.add(isYes ? "success" : "error");
          if (statusIcon) statusIcon.textContent = isYes ? "✓" : "!";
          if (modalTitle)
            modalTitle.textContent = isYes ? "Eligible" : "Not Eligible";
          if (modalSubtitle)
            modalSubtitle.textContent = isYes
              ? "Great news!"
              : "Please review your details.";

          function closeModal() {
            modal.style.display = "none";
          }
          document.getElementById("modal-close").onclick = closeModal;
          document.getElementById("modal-ok").onclick = closeModal;
          window.onclick = function (event) {
            if (event.target === modal) closeModal();
          };
        }

        // Loading overlay on submit
        var form = document.getElementById("predict-form");
        var overlay = document.getElementById("loading-overlay");
        if (form && overlay) {
          form.addEventListener("submit", function (e) {
            if (form.getAttribute("data-submitting") === "1") {
              return;
            }
            e.preventDefault();
            overlay.style.display = "flex";
            overlay.style.opacity = "1";
            // force reflow so overlay paints before navigation
            void overlay.offsetHeight;
            form.setAttribute("data-submitting", "1");
            form.submit();
          });
        }
      })();
    </script>
  </body>
</html>
